"use strict";angular.module("app.controller",[]).controller("essayEditorCtrl",["$scope","$http","$uibModal","SweetAlert",function(t,e,n,o){e({method:"GET",url:"/post/"+t.$stateParams.id}).success(function(e){t.post=e,t.post.tags=t.post.tags||[]}),t.open=function(){n.open({animation:!0,templateUrl:"views/template/markdown-content.html",size:"md"})},t.postSettings=function(){n.open({animation:!0,templateUrl:"views/template/post-settings.html",windowTemplateUrl:"views/template/aside.html",size:"md aside-right",controller:"postModalInstance",resolve:{post:function(){return t.post}}})},t.ok=function(){return e({method:"PUT",data:t.post,url:"/post/"+t.post._id}).success(function(e){t.post.tags=t.post.tags||[],o.swal("Good job!","修改成功!","success")})}}]).controller("postModalInstance",["$scope","$http","post",function(t,e,n){t.post=n}]).filter("getCol",function(){return function(t,e){return t&&t.map(function(t){return t[e]}).join(",")}}).directive("tagEditor",function(){return{restrict:"AE",scope:{tags:"=ngModel"},replace:!0,templateUrl:"views/template/ng-tag-editor.html",controller:["$scope","$attrs","$element","$http","$filter",function(t,e,n,o,s){t.options=[],t.options.output=e.output||"name",t.options.fetch=e.fetch||"/tag",t.options.placeholder=e.placeholder||"Enter a few letters...",t.options.apiOnly=e.apiOnly||!1,t.search="",o.get(t.options.fetch).success(function(e){t.suggestions=e}),t.add=function(e,n){var o=t.tags.filter(function(t){return t.name==n});if(0==o.length){var s=t.suggestions.filter(function(t){return t.name==n});0==s.length?t.tags.push({name:n}):t.tags.push(s[0])}t.search=""},t.remove=function(e){t.tags.splice(e,1)},t.tagsFilter=function(e){return 0==t.tags.filter(function(t){return t._id===e._id||t.name===e.name}).length&&(""==t.search||e.name.indexOf(t.search)>=0)},n.find("input").on("keydown",function(e){var n=[8,13,32];n.indexOf(e.which)!==-1&&(8==e.which?0===t.search.length&&t.tags.length&&(t.tags.pop(),e.preventDefault()):32!=e.which&&13!=e.which||t.search.length&&!t.apiOnly&&(t.apiOnly||(t.add(0,t.search),e.preventDefault())),t.$apply())}).on("blur",function(e){t.search.length&&!t.apiOnly&&(t.apiOnly||(t.add(0,t.search),e.preventDefault())),t.$apply()})}]}});