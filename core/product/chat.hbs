{{#contentFor 'styles'}}
    <link rel='stylesheet' href="{{asset '/bower_components/bootstrap/dist/css/bootstrap.css'}}"/>
    <!-- build:css  /product/css/chat.pkg_version.css -->
    <link rel='stylesheet' href='/public/css/flexbox.css'/>
    <link rel='stylesheet' href='/product/css/chat.css'/>
    <!-- endbuild -->
{{/contentFor}}

<body>
<main class="main-container">
    <ul id="chat-wrap">
        <li class="template">
            <div class="chat-portrait">
                <img class="portrait-img" src="{{visitor.image}}">
            </div>
            <div class="date"></div>
            <div class="content">

            </div>
        </li>
    </ul>
</main>
<div class="chat-container">
    <form class="flex-column" style="height:100%">
        <div class="form-group flex-full">
            <textarea class="form-control" style="resize: vertical;height:100%" required></textarea>
            <input type="hidden" name="image" value="{{cookies.image}}">
        </div>
        <div class="text-right">
            <button type="submit" class="btn btn-success">button</button>
        </div>
    </form>
</div>
</body>

{{#contentFor 'scripts'}}
    <script src="{{asset '/bower_components/jquery/dist/jquery.js'}}"></script>
    <script src="{{socket '/socket.io/socket.io.js'}}"></script>
    <script>
        var socket = io.connect("{{socket '/chat'}}");
        socket.on('new', function (data) {
            console.log(data);
        });
        socket.on('chat', function (data) {
            var $li = $("#chat-wrap .template").clone().removeClass("template").addClass("chat-item")
            var $container = $(".main-container");
            var scroll = $container[0].scrollHeight - $container.scrollTop() > $container.height();
            $li.find(".content").html(data.message);
            $li.find(".date").html(data.date);
            $("#chat-wrap").append($li);
            if(!scroll){/* 往上滚动 */
                $container.scrollTop($container[0].scrollHeight);
            }
        });
    </script>
{{/contentFor}}
